## MySql

### B+树

- B+树的叶子节点是有指针的
- 有冗余 插入的节点都在叶子节点
- 一个结点里面有多个元素


### 事务的基本要素 （ACID）

- 原子性：事务开始后的所有操作，要么全部做完，要么全部失败
- 一致性：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。
- 隔离性：同一时间，只允许一个事务请求统一数据，不同的事务之间没有任何干扰
- 持久性：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。

### 事务的并发问题

- 脏读:事务A读取了事务B更新的数据，然后事务B回滚，那么A读到了脏数据。
- 不可重复读：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致
- 幻读:系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读

**小结** 不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表

### 事务隔离级别

- 读未提交：
- 不可重复读：可以解决脏读
- 可重复读：可以解决脏读 不可重复读
- 串行化：可以解决所有

#### 问题

- 事务隔离级别为读提交时，写数据只会锁住相应的行
- 事务隔离级别为可重复读时，如果检索条件有索引（包括主键索引）的时候，默认加锁方式是next-key 锁；如果检索条件没有索引，更新数据时会锁住整张表。一个间隙被事务加了锁，其他事务是不能在这个间隙插入记录的，这样可以防止幻读。
- 事务隔离级别为串行化时，读写数据都会锁住整张表
-  隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大。